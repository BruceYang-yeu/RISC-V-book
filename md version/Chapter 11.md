# 11. RISC-V未来的可选扩展

对于复杂性，傻子无视它，实用主义者忍受它，有的人有时能规避它，而天才则解决它。

—— Alan Perlis, 1982

>>>![](pics/AlanPerlis.png)
>>>
>>>>>>>>>**Alan Perlis**（1922-1900），因为在高级编程语言和编译器领域的贡献而成为第一位图灵奖得主（1966）。1958年参与设计了ALGOL，对后来所有的命令式语言，包括C和Java都有巨大影响。

以RISC-V为基础，至少可以有8种可选的扩展。

## 11.1 "B"标准扩展：位操作

B扩展提供位操作，包括插入、提取和测试位字段（insert, extract, and test bit fields），旋转（rotations），漏斗位移（funnel shifts），位置换和字节置换（bit and byte permutations），计算前导0和尾随0（count leading and trailing zeros）和计算置位数（count bits set）等。

## 11.2 "E"标准扩展：嵌入式

为了降低对低端核心的开销，这个扩展少了16个寄存器。正是因为RV32E，被保存寄存器和临时寄存器都是在0-15号和16-31号这两部分之间分开的（图3.2）。

## 11.3 "H"特权态架构扩展：支持管理程序（Hypervisor）

> > > ![](pics/icon3.png)

H特权架构扩展加入了管理程序模式和基于内存页的二级地址翻译机制，提高在同一台计算机上运行多个操作系统的效率。

## 11.4 "J"标准扩展：动态翻译语言

> > > ![](pics/icon3.png)

有许多常用的语言使用了动态翻译，比如Java和Javascript。这些语言的动态检查和垃圾回收可以得到ISA的支持。（J表示即时（Just-In-Time）编译。）

## 11.5 "L"标准扩展：十进制浮点

> > > ![](pics/icon7.png)

L扩展的目的是支持IEEE 754-2008标准规定的十进制浮点算术运算。二进制数的问题在于无法表示出一些常用的十进制小数，如0.1。RV32L使得计算基数可以和输入输出的基数相同。

## 11.6 "N"标准扩展：用户态中断

> > >![](pics/icon2.png)

> >> ![](pics/icon4.png)

N扩展允许用户态程序发生中断和例外后，直接进入用户态的处理程序，不触发外层运行环境响应。用户态中断主要用于支持存在M模式和U模式的安全嵌入式系统（见第10章）。不过，它也能支持类Unix操作系统中的用户态中断。当在Unix环境中使用时，传统的信号处理机制依然保留，而用户态中断可以用来做未来的扩展，产生诸如垃圾回收屏障（garbage collection barriers）、整数溢出（integer overflow）、浮点陷入（floating-point traps）等用户态事件。

## 11.7 "P"标准扩展：封装的单指令多数据（Packed-SIMD）指令

> > > ![](pics/icon3.png)

P扩展细分了现有的寄存器架构，提供更小数据类型上的并行计算。封装的单指令多数据指令代表了一种合理复用现有宽数据通路的设计。不过，如果有额外的资源来进行并行计算，第8章的向量架构通常是更好的选择，设计者更应使用RVV扩展。

## 11.8 "Q"标准扩展：四精度浮点

Q扩展增加了符合IEEE 754-2008标准的128位的四精度浮点指令。扩展后的浮点寄存器可以存储一个单精度、双精度或者四精度的浮点数。四精度浮点扩展要求RV64IFD。

## 11.9 结束语

简化，简化。

—— 亨利·大卫·梭罗（Henry David Thoreau），19世纪著名作家，1854

> > > ![](pics/icon5.png)

> > > ![](pics/icon8.png)

RISC-V具有开放、标准的扩展方式，可能意味着可以在指令集最终确定之前得到反馈和争论，使得进一步的修改为时未晚。理想情况下，一小部分成员将先把一个提议实现出来，然后再提交通过，而FPGA上让实现的过程变得很容易。通过RISC-V基础委员会提交指令扩展所需工作量比较适中，他们将努力控制ISA变动的速度，至少不会像x86-32那样有太快的变化（见第\[1\]章的图1.2）。另外别忘了，不管有多少扩展被应用了，这一章提到的这些东西都是可选的。

我们希望RISC-V可以在保持简洁和高效的同时适应技术需求的发展。如果RISC-V成功了，它将成为以往增量式ISA上的一次革命性突破。
